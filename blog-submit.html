<!DOCTYPE html>

<html>

<head>
    <title>Submit a new post</title>

    <script src="https://cdn.quilljs.com/1.1.3/quill.js"></script>
    <script src="https://cdn.quilljs.com/1.1.3/quill.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <!--Thanks for the stylin', Quilljs!-->
    <link href="https://cdn.quilljs.com/1.1.3/quill.snow.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.1.3/quill.bubble.css" rel="stylesheet">

    <style>
        #editor {
            height: 30rem;
        }

        #comment-box {
            display: flex;
            flex-direction: column;
            height: 5rem;
            width: 80vw;
            overflow: scroll;
            border: 1px;
            border-style: solid;
        }

        #comment-box h3 {
            justify-content: right;
        }
    </style>

</head>

<body>
    <div id="toolbar"></div>
    <div id="editor"></div>

    <button id="saveButton">Save Post Into DB</button>

    <h1>Comments 4 all you h8terz</h1>
    <div id="pseudo-editor"></div>
    <script>

        $(document).ready(function () {

            let toolbarOptions = [
                ['bold', 'italic', 'underline', 'strike'],
                ['blockquote', 'code-block'],
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                [{ 'script': 'sub' }, { 'script': 'super' }],
                [{ 'indent': '-1' }, { 'indent': '+1' }],
                [{ 'size': ['small', false, 'large', 'huge'] }],
                ['link', 'image', 'video', 'formula'],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'font': [] }],
                [{ 'align': [] }]
            ];

            let quill = new Quill('#editor', {
                modules: {
                    toolbar: toolbarOptions
                },
                placeholder: 'Compose an epic...',
                theme: 'snow'
            });


            // Want this to happen by default on page load before user sees
            // Get + display persistent old comments from posts database
            $.get("/dbComments", function (data) {
                console.log(data, " is the data");
                for (let i = 0; i < data.length; i++) {
                    $("#pseudo-editor").append(
                        "<div id =\"comment-box\">" +
                        "<h3>" +
                        "Posted on " + data[i].entry_time.split("T")[0].replace(/-/g, "/") + " by dumb Anon" +
                        "</h3>" +
                        "<div id=\"comment-content\"" +
                        data[i].content +
                        "</div>" +
                        "</div>"
                    );
                }
            });

            $('#saveButton').click(function () {


                // Visually show the new comment getting appended to existing comments for user
                // let newComment = quill.getContents();
                // let oldComments = quill2.getContents();
                // let combinedComments = oldComments.concat(newComment);
                // quill2.setContents(combinedComments);

                // Grab text that user is trying to submit, make it a JSON format
                let text = quill.container.firstChild.innerHTML;
                let reqBody = {
                    "content": text,
                };

                // Post JSON formatted new comment to posts database
                $.ajax({
                    type: "post",
                    data: JSON.stringify(reqBody),
                    url: '/submit',
                    dataType: 'json',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    success: function (data) {
                        console.log("The data posted is: ", data);
                    },
                    error: function (e) {
                        console.log("POST REQ ERROR : ", e);
                    }
                });
            });

        });
    </script>


</body>

</html>